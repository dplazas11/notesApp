<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Listar Notas</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                display: flex;
                margin: 0;
                background-color: #f0f8ff;
            }

            /* Men√∫ lateral (id√©ntico al de crear nota) */
            nav {
                width: 220px;
                background-color: #007acc;
                height: 100vh;
                padding-top: 20px;
                position: fixed;
                top: 0;
                left: 0;
                color: white;
            }

            nav h2 {
                text-align: center;
                color: white;
                margin-bottom: 30px;
            }

            nav a {
                display: block;
                color: white;
                padding: 15px 25px;
                text-decoration: none;
                font-weight: bold;
                transition: background-color 0.3s;
            }

            nav a:hover {
                background-color: #005b99;
            }


            /* Contenedor principal */
            .main {
                margin-left: 240px;
                width: calc(100% - 240px);
                padding: 30px;
            }

            h1 {
                color: #007acc;
                text-align: center;
            }

            /* Tabla de notas */
            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
                background-color: white;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 0 10px rgba(0,0,0,0.2);
            }

            th, td {
                border-bottom: 1px solid #cce6ff;
                text-align: center;
                margin-left: 340px; /* deja espacio para el men√∫ */
                padding: 12px;
            }

            th {
                background-color: #b3e0ff;
                color: #004466;
            }

            tr:hover {
                background-color: #e6f7ff;
            }

            .buttons {
                margin-top: 25px;
                text-align: center;
            }

            button {
                background-color: #4da6ff;
                color: white;
                border: none;
                padding: 10px 18px;
                margin: 5px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: bold;
            }

            button:hover {
                background-color: #007acc;
            }

            .acciones a {
                margin-right: 10px;
                color: #007acc;
                text-decoration: none;
                font-weight: bold;
            }

            .acciones a:hover {
                text-decoration: underline;
            }
        </style>
    </head>
    <body>

        <!-- Men√∫ lateral igual al de crear nota -->
        <nav>
            <h2>MENU</h2>
            <a th:href="@{/inicio}">üìù Crear Nota</a>
            <a th:href="@{/listar}">üìã Ver Notas</a>
        </nav>

        <div class="main">
            <h1>Listado de Notas</h1>

            <div id="mensaje" style="display:none; padding:10px; border-radius:8px; margin-bottom:10px;"></div>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√≠tulo</th>
                        <th>Descripci√≥n</th>
                        <th>Fecha</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="nota : ${notas}">
                        <td th:text="${nota.notasid}"></td>
                        <td th:text="${nota.titulo}"></td>
                        <td th:text="${nota.descripcion}"></td>                        
                        <td th:text="${nota.fecha}"></td>
                        <td class="acciones">
                            <button type="button" th:onclick="'window.location.href=\'/verNota/' + ${nota.notasid} + '\';'">
                                Ver
                            </button>                           
                            <button type="button"
                                    th:attr="data-id=${nota.notasid}"
                                    onclick="eliminarNota(this.getAttribute('data-id'))">
                                Eliminar
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <script>
            function eliminarNota(id) {
                if (!confirm("¬øDeseas eliminar esta nota?"))
                    return;

                fetch(`/eliminar/${id}`, {method: "DELETE"})
                        .then(response => {
                            if (!response.ok)
                                throw new Error("Error HTTP: " + response.status);
                            return response.text();
                        })
                        .then(texto => {
                            mostrarMensaje(texto, true);
                            setTimeout(() => location.reload(), 1500); // recarga la lista despu√©s de eliminar
                        })
                        .catch(error => {
                            mostrarMensaje("‚ùå Error al eliminar la nota", false);
                            console.error(error);
                        });
            }

            function mostrarMensaje(texto, exito) {
                const mensajeDiv = document.getElementById("mensaje");
                mensajeDiv.style.display = "block";
                mensajeDiv.style.backgroundColor = exito ? "#d4edda" : "#f8d7da";
                mensajeDiv.style.color = exito ? "#155724" : "#721c24";
                mensajeDiv.textContent = texto;
            }
        </script>

    </body>
</html>